---
- vars:
    elastic_index_parameters: &elastic_index_parameters
      login_user: elastic
      login_password: secret
      auth_method: http_auth
      timeout: 90

  block:

    - name: Test with shards level 3
      community.elastic.elastic_cluster_health:
        <<: *elastic_index_parameters
        level: shards
        connection_options:
          verify_certs: false
      register: elastic

    - assert:
        that:
          - "elastic.msg == 'Elasticsearch health is good. The variable number_of_nodes has reached the value 3.'"
          - "elastic.iterations >= 1"
          - "elastic.changed == False"